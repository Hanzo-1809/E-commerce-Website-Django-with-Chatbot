{% extends "templates/web.html" %}

{% block page_content %}
<div class="bg-gray-100 min-h-screen py-12">
    <div class="max-w-lg mx-auto bg-white rounded-lg shadow-md overflow-hidden">
        <div class="px-6 py-4 bg-red-600 text-white">
            <h1 class="text-xl font-bold">Delete Book</h1>
        </div>

        <div class="p-6">
            <div class="flex items-center justify-center mb-6">
                <div class="h-16 w-16 flex-shrink-0 flex items-center justify-center bg-red-100 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-600" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                            clip-rule="evenodd" />
                    </svg>
                </div>
            </div>

            <div id="book-details" class="mb-6">
                <h2 class="text-lg font-medium text-center text-gray-900 mb-4">Are you sure you want to delete this
                    book?</h2>

                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="flex items-center mb-4">
                        <div id="book-image"
                            class="h-16 w-16 bg-gray-200 rounded flex-shrink-0 flex items-center justify-center mr-4">
                            <span class="text-xs text-gray-500">No image</span>
                        </div>
                        <div>
                            <h3 id="book-title" class="font-medium">Loading...</h3>
                            <p id="book-id" class="text-sm text-gray-500">Loading...</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">Category:</span>
                            <span id="book-category" class="ml-1">Loading...</span>
                        </div>
                        <div>
                            <span class="text-gray-500">Price:</span>
                            <span id="book-price" class="ml-1">Loading...</span>
                        </div>
                        <div>
                            <span class="text-gray-500">Status:</span>
                            <span id="book-status" class="ml-1">Loading...</span>
                        </div>
                    </div>
                </div>

                <p class="text-sm text-gray-500 mt-6 text-center">
                    This action cannot be undone. This will permanently delete the book data from the database.
                </p>
            </div>

            <div class="flex justify-center space-x-4">
                <a href="/books"
                    class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    Cancel
                </a>
                <button type="button" id="btn-confirm-delete"
                    class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    Yes, Delete Book
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    frappe.ready(function () {
        // Get book ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const bookId = urlParams.get('book_id');

        if (!bookId) {
            // Redirect to books page if no book ID provided
            window.location.href = '/books';
            return;
        }

        // Load book data
        frappe.call({
            method: 'frappe.client.get',
            args: {
                doctype: 'Book',
                name: bookId
            },
            callback: function (r) {
                if (r.message) {
                    const book = r.message;

                    // Fill book details
                    document.getElementById('book-title').textContent = book.book_name || 'Untitled Book';
                    document.getElementById('book-id').textContent = book.id || 'No ID';
                    document.getElementById('book-category').textContent = book.category_id || 'Uncategorized';
                    document.getElementById('book-price').textContent = book.price ? `$${book.price.toFixed(2)}` : '$0.00';
                    document.getElementById('book-status').textContent = book.status || 'Draft';

                    // Display book image if exists
                    if (book.thumbnail) {
                        const imgContainer = document.getElementById('book-image');
                        imgContainer.innerHTML = `<img src="${book.thumbnail}" alt="${book.book_name}" class="h-16 w-16 object-cover rounded">`;
                    }
                } else {
                    frappe.throw(__('Book not found'));
                }
            }
        });

        // Handle delete button click
        document.getElementById('btn-confirm-delete').addEventListener('click', function () {
            frappe.call({
                method: 'frappe.client.delete',
                args: {
                    doctype: 'Book',
                    name: bookId
                },
                callback: function (r) {
                    if (!r.exc) {
                        frappe.show_alert({
                            message: 'Book deleted successfully',
                            indicator: 'green'
                        });

                        // Redirect to books page after short delay
                        setTimeout(function () {
                            window.location.href = '/books';
                        }, 1500);
                    }
                }
            });
        });
    });
</script>
{% endblock %}

{% block head_include %}
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
{% endblock %}