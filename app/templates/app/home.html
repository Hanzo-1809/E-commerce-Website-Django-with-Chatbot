{% load static %}
{% include 'app/navbar.html' %}
<!DOCTYPE html>

<html lang="en">
<head>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'app/css/navbar.css' %}">
<link rel="stylesheet" href="{% static 'app/css/style.css' %}">
<link rel="stylesheet" href="{% static 'app/css/chatbot.css' %}">

</head>
<body>
    <main>
      <section class="section" id="section1">
        <img src="{% static 'app/images/banner4.png' %}" alt="">
        <button>
          <a href="Shop.jsp">SHOP NOW</a>
        </button>
      </section>
  
      <section class="section section2" id="section2">
        <div class="heading">
          <div class="title">Trending book</div>
          <a href="Shop.jsp">View all <i class="ri-arrow-right-line"></i></a>
        </div>
  
  
        <div class="slider-wrapper">
          <button class="prev-btn">
            <i class="ri-arrow-left-s-line"></i>
          </button>
          <button class="next-btn">
            <i class="ri-arrow-right-s-line"></i>
          </button>
  
  <div class="slider-wrapper-item">
    {% for product in products %}
      <div class="card">
        <a href="{% url 'detail' %}?id={{product.id}}" class="img-box">
          <img src="{{ product.ImageURL }}" alt="">
        </a>
        <a href="" class="book-title">{{ product.name }}</a>
        <div class="book-cost">
          <div class="cost">{{ product.price|floatformat:2 }}$</div>
        </div>
        <div class="sold">
          <p>Sold:</p>
          {% comment %} <p>5.5k</p> {% endcomment %}
          <div class="rates">
            <div class="star">
              {% for i in "12345" %}
                <i class="ri-star{% if product.rating < i %}-half-line{% else %}-fill{% endif %}"></i>
              {% endfor %}
            </div>
            {% comment %} <div class="rate">120.212  votes</div> {% endcomment %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

      </section>
      <section class="section section2" id="section3">
        <div class="heading">
          <div class="title">Flash sales</div>
          <a href="Shop.jsp">View all <i class="ri-arrow-right-line"></i></a>
        </div>
        <div class="slider-wrapper">
          <div class="slider-wrapper-item">
            {% for product in products %}
              <div class="card">
                <a href="{% url 'detail' %}?id={{product.id}}" class="img-box">
                  <img src="{{ product.ImageURL }}" alt="{{ product.name }}">
                </a>
                <a href="" class="book-title">{{ product.name }}</a>
                <div class="book-cost">
                  <div class="cost">{{ product.price|floatformat:2 }}$</div>
                </div>
                <div class="sold">
                  <p>Sold:</p>
                  <p>{{ product.sold }}</p>
                  <div class="rates">
                    <div class="star">
                      {% for i in "12345" %}
                        <i class="ri-star{% if product.rating < i %}-half-line{% else %}-fill{% endif %}"></i>
                      {% endfor %}
                    </div>
                    <div class="rate">{{ product.votes }} votes</div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
      
      </section>
      <section class="section" id="section4">
        <div class="heading">
          <div class="title">Books of the week-Top Seller</div>
        </div>
        <div class="wrapper">
          <div class="links">

          </div>
          <div class="tab-contents">
            <!-- literary -->
            <div class="tab-content active">
              <div class="top-rank-wrapper">
                <div class="top-rank">
                  {% for product in top_products %}
                  <!-- top {{ forloop.counter }} -->
                  <div class="item {% if forloop.first %}active{% endif %}">
                    <div class="rank">0{{ forloop.counter }}</div>
                    <a href="{% url 'detail' product.id %}" class="book">
                     <div class="book" style="width: 80px; height: 120px; overflow: hidden;">
    <img src="{{ product.ImageURL }}" alt="{{ product.name }}" style="width: 100%; height: 100%; object-fit: cover;">
</div>
                    </a>
                    <div class="book-details">
                      <a href="{% url 'detail' product.id %}" class="title">{{ product.name }}</a>
                      <div class="author">{{ product.author|default:"Unknown" }}</div>
                      <div class="rates">
                        <div class="star">
                          {% for i in "12345" %}
                            {% with star_value=forloop.counter|floatformat:"0" %}
                              {% if product.average_rating >= star_value %}
                                <i class="ri-star-fill"></i>
                              {% elif product.average_rating >= star_value|add:"-0.5" %}
                                <i class="ri-star-half-line"></i>
                              {% else %}
                                <i class="ri-star-line"></i>
                              {% endif %}
                            {% endwith %}
                          {% endfor %}
                        </div>
                        <div class="rate">{{ product.total_reviews }} votes</div>
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                </div>
                 <div class="top-rank-content">
            {% for product in top_products %}
              <!-- top {{ forloop.counter }} content -->
              <div class="item {% if forloop.first %}active{% endif %}">
                <div class="book">
                  <img src="{{ product.ImageURL }}" alt="{{ product.name }}">
                </div>
                <div class="book-details">
                  <div class="title">{{ product.name }}</div>
                  <div class="author">{{ product.author|default:"Unknown" }}</div>
                  <div class="rates">
                    <div class="star">
                      {% for i in "12345" %}
                        {% with star_value=forloop.counter|floatformat:"0" %}
                          {% if product.average_rating >= star_value %}
                            <i class="ri-star-fill"></i>
                          {% elif product.average_rating >= star_value|add:"-0.5" %}
                            <i class="ri-star-half-line"></i>
                          {% else %}
                            <i class="ri-star-line"></i>
                          {% endif %}
                        {% endwith %}
                      {% endfor %}
                    </div>
                    <div class="rate">{{ product.total_reviews }} votes</div>
                  </div>
                  <div class="cost">
                    <div class="sold-cost">{{ product.price|floatformat:2 }} $</div>
                    <!-- Nếu có giá gốc thì hiển thị -->
                    {% if product.original_price %}
                      <div class="old-cost">{{ product.original_price|floatformat:2 }} $</div>
                    {% endif %}
                  </div>
                  {% comment %} <div class="description">{{ product.description|truncatewords:30 }}</div> {% endcomment %}
                  <div class="description">Khám phá cuốn sách đầy cảm hứng – "{{ product.name }}" .
                    lối hành văn lôi cuốn cùng kiến thức bổ ích . 
                    Với nội dung được biên soạn kỹ lưỡng và thiết kế hiện đại, 
                    cuốn sách này chắc chắn sẽ là người bạn đồng hành lý tưởng trên hành trình phát triển bản thân .</div>
                  <div class="buy-btn">
                    <button class="add-to-cart-btn" data-product="{{ product.id }}">
                      ADD TO CART <i class="ri-shopping-cart-line"></i>
                    </button>
                    <button onclick="location.href='{% url 'detail' product.id %}'">BUY NOW</button>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
        <button>
          <a href="{% url 'category' %}">Show more</a>
        </button>
      </div>
    </div>
  </div>
</section>
      {% comment %} <section class="section section2" id="section5">
        <div class="heading">
          <div class="title">Featured books</div>
          <a href="Shop.jsp">View all <i class="ri-arrow-right-line"></i></a>
        </div>
        <div class="slider-wrapper">
          <div class="slider-wrapper-item">
  
            <div class="card">
              <a href="ProductPage.jsp?bid=<%=b.getBookId()%>" class="img-box"> <img
                src="#" alt="">
              </a> <a href="ProductPage.jsp" class="book-title">The Twilight Zone</a>
  
              <div class="book-cost">
                <div class="cost">1$</div>
  
              </div>
              <div class="sold">
                <p>Sold:</p>
                <p>5.5k</p>
                <div class="rates">
                  <div class="star">
                    <i class="ri-star-fill"></i> <i class="ri-star-fill"></i> <i
                      class="ri-star-fill"></i> <i class="ri-star-fill"></i> <i
                      class="ri-star-half-line"></i>
                  </div>
                  <div class="rate">120.212 votes</div>
                </div>
              </div>
            </div>
          </div>
  
        </div>
            
          
      </section> {% endcomment %}
    </main>
    <footer>
      <div class="box box1">JBOOK</div>
      <div class="box box2">
        <div class="title">Home</div>
        <a href="./Shop.html">Shop</a> <a href="">Blog</a> <a
          href="./AboutUs.html">About Us</a>
      </div>
      <div class="box box3">
        <div class="title">Categories</div>
        <a href="./Shop.html">Fiction</a> <a href="./Shop.html">Lifestyle</a>
        <a href="./Shop.html">Comic book</a> <a href="./Shop.html">Food &
          drink</a>
      </div>
      <div class="box box4">
        <div class="title">Contact</div>
        <p>Call: +84 762 2123</p>
        <p>Address: 54 Nguyen Luong Bang,Hoa Khanh Bac ward, Lien Chieu
          district, Da Nang, Vietnam</p>
        <p>Email: pbl3example@email.com</p>
      </div>
    </footer>
<br /> <br /> <br />
<button class="chatbot-toggle">
  <i class="fa fa-comments"></i> Chat với tôi
</button>

<div class="chatbot-container">
  <div class="chatbot-header">
    <i class="fa fa-robot"></i> Trợ lý JBook
  </div>
  <div class="chatbot-body" id="chatbot-body">
    <!-- Chatbot messages will be inserted here by JavaScript -->
  </div>
  <div class="chatbot-input">
    <input type="text" id="user-input" placeholder="Nhập câu hỏi của bạn..." autofocus>
    <button id="send-btn">
      <i class="fa fa-paper-plane"></i>
    </button>
  </div>
</div>

<script>
  const csrf_token = '{{ csrf_token }}';
</script>
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    // Xử lý sự kiện thêm vào giỏ hàng
    const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
    
    addToCartButtons.forEach(button => {
      button.addEventListener('click', function() {
        const productId = this.dataset.product;
        
        // Gửi yêu cầu thêm vào giỏ hàng
        updateUserOrder(productId, 'add');
      });
    });
    
    // Hàm thêm vào giỏ hàng
    function updateUserOrder(productId, action) {
      console.log('User is authenticated, sending data...');
      
      const url = '{% url "update_item" %}';
      
      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}',
        },
        body: JSON.stringify({'productId': productId, 'action': action})
      })
      .then(response => response.json())
      .then(data => {
        console.log('Data:', data);
        // Cập nhật số lượng sản phẩm trong giỏ hàng
        location.reload();
      });
    }
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var links = document.querySelectorAll('main #section4 .wrapper .links a');
    var content = document.querySelectorAll('main #section4 .wrapper .tab-contents .tab-content .top-rank-wrapper .top-rank-content .item');
    var items = document.querySelectorAll('main #section4 .wrapper .tab-contents .tab-content .top-rank-wrapper .top-rank .item');
    var items1 = document.querySelectorAll('main #section4 .wrapper .tab-contents .tab-content .top-rank-wrapper .top-rank-content .item');


    links.forEach(function(link, index) {
        link.addEventListener('click', function() {
            // Loại bỏ lớp active từ tất cả các liên kết và nội dung
            links.forEach(function(link) {
                link.classList.remove('active');
            });
            content.forEach(function(contentItem) {
                contentItem.classList.remove('active');
            });

            // Thêm lớp active cho liên kết được click và nội dung tương ứng
            this.classList.add('active');
            content[index].classList.add('active');

            // Xóa lớp active từ tất cả các phần tử trong top-rank và top-rank-content
            items.forEach(function(item) {
                item.classList.remove('active');
            });
            items1.forEach(function(item) {
                item.classList.remove('active');
            });

            // Thêm lớp active cho phần tử đầu tiên trong top-rank và top-rank-content
            items[0].classList.add('active');
            items1[0].classList.add('active');
        });
    });

    // Xử lý sự kiện hover cho các phần tử trong top rank
    items.forEach(function(item, index) {
        item.addEventListener('mouseover', function() {
            // Loại bỏ lớp active từ tất cả các phần tử trong cả top rank và top rank content
            items.forEach(function(item) {
                item.classList.remove('active');
            });
            items1.forEach(function(item) {
                item.classList.remove('active');
            });

            // Thêm lớp active cho phần tử được hover trong top rank và top rank content tương ứng
            this.classList.add('active');
            items1[index].classList.add('active');
        });
    });
});
</script>
<script src="{% static 'app/js/script.js' %}"></script>
<script src="{% static 'app/js/chatbot.js' %}"></script>
</body>
</html>
